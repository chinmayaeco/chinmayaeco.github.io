<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IS-LM Curve Equilibrium Simulation</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a237e 0%, #4a148c 50%, #880e4f 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            flex: 1;
            min-width: 300px;
        }
        
        .simulation-panel {
            border-top: 5px solid #3498db;
        }
        
        .case-studies {
            border-top: 5px solid #e74c3c;
        }
        
        .managerial-implications {
            border-top: 5px solid #2ecc71;
        }
        
        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
        }
        
        h3 {
            color: #3498db;
            margin: 15px 0 10px;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px 0;
            transition: background-color 0.3s;
            width: 100%;
            text-align: left;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .question {
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
            border-left: 4px solid #3498db;
            border-radius: 5px;
        }
        
        .options {
            margin-left: 0;
        }
        
        .score-display {
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .password-box {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
        }
        
        .password-box input {
            padding: 12px;
            margin: 15px 0;
            width: 100%;
            border: 2px solid #3498db;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .hidden {
            display: none;
        }
        
        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
        }
        
        .correct {
            background-color: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        .concept-definition {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .concept-type {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .islm-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .curve-card {
            background-color: #e8f4fc;
            padding: 15px;
            border-radius: 5px;
            flex: 1;
            min-width: 120px;
            text-align: center;
            font-size: 0.9rem;
            border: 1px solid #3498db;
        }
        
        .interactive-simulation {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .simulation-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .policy-choice {
            padding: 8px 12px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
        }
        
        .calculator-container {
            background-color: #f0f8ff;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #2980b9;
        }
        
        .calculator-input {
            margin: 10px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
        }
        
        .formula-box {
            font-family: 'Courier New', monospace;
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            border: 2px solid #3498db;
        }
        
        .economic-indicator {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #ffc107;
        }
        
        .indicator-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin: 10px 0;
        }
        
        .strategy-game {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }
        
        .policy-result {
            background-color: #e3f2fd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
        }
        
        .graph-container {
            width: 100%;
            height: 300px;
            background-color: #f8f9fa;
            margin: 15px 0;
            position: relative;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
        }
        
        .graph-axis {
            position: absolute;
            background-color: #6c757d;
        }
        
        .graph-line {
            position: absolute;
            height: 2px;
        }
        
        .graph-label {
            position: absolute;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .equilibrium-point {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #e74c3c;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        .policy-tabs {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 2px solid #3498db;
        }
        
        .policy-tab {
            padding: 10px 15px;
            background-color: #e8f4fc;
            border: none;
            cursor: pointer;
            flex: 1;
            text-align: center;
        }
        
        .policy-tab.active {
            background-color: #3498db;
            color: white;
        }
        
        .policy-content {
            display: none;
        }
        
        .policy-content.active {
            display: block;
        }
        
        .attempt-counter {
            background-color: #f8d7da;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 5px 0;
            font-size: 0.9rem;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .simulation-controls {
                flex-direction: column;
            }
            
            .policy-tabs {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="password-screen" id="passwordScreen">
        <div class="password-box">
            <h2>IS-LM Curve Equilibrium Simulation</h2>
            <p>Enter the password to access the simulation:</p>
            <input type="password" id="passwordInput" placeholder="Enter password">
            <button onclick="checkPassword()">Enter</button>
            <p id="passwordError" style="color: red; display: none; margin-top: 10px;">Incorrect password. Try again.</p>
        </div>
    </div>

    <div class="container" id="gameContent" style="display: none;">
        <header>
            <h1>IS-LM Curve Equilibrium Simulation</h1>
            <p>Explore simultaneous equilibrium in goods and money markets through strategic policy decisions</p>
        </header>
        
        <div class="score-display">
            Your Score: <span id="score">0</span>% &nbsp; | &nbsp; 
            Policy Attempts: <span id="policyAttempts">0</span>/5 &nbsp; | &nbsp;
            Equilibrium Status: <span id="equilibriumStatus">Not Achieved</span>
        </div>
        
        <div class="game-container">
            <div class="panel simulation-panel">
                <h2>Simulation Panel</h2>
                <p>Make strategic fiscal and monetary policy decisions to achieve simultaneous equilibrium.</p>
                
                <div class="concept-definition">
                    <span class="concept-type">IS-LM Model Fundamentals:</span>
                    <div class="islm-cards">
                        <div class="curve-card">
                            <h4>IS Curve</h4>
                            <p>Goods Market Equilibrium</p>
                            <p>Y = C + I + G</p>
                        </div>
                        <div class="curve-card">
                            <h4>LM Curve</h4>
                            <p>Money Market Equilibrium</p>
                            <p>M/P = L(Y, r)</p>
                        </div>
                        <div class="curve-card">
                            <h4>Equilibrium</h4>
                            <p>Both Markets Clear</p>
                            <p>IS = LM</p>
                        </div>
                    </div>
                    <div class="formula-box">
                        IS: Y = α(A - b·r) &nbsp;&nbsp; LM: r = (k/h)Y - (1/h)(M/P)
                    </div>
                </div>
                
                <div class="graph-container" id="islmGraph">
                    <!-- IS-LM graph will be drawn here -->
                </div>
                
                <div class="strategy-game">
                    <h3>Policy Coordination Challenge</h3>
                    <p><strong>Scenario:</strong> The economy is in recession with high unemployment (8%) and excess money demand. Current equilibrium is below potential output.</p>
                    
                    <div class="economic-indicator">
                        <p><strong>Current Economic Status:</strong></p>
                        <div class="indicator-value" id="outputGap">-$300B (Recessionary Gap)</div>
                        <div class="indicator-value" id="interestRate">Interest Rate: 3%</div>
                        <p>Unemployment: 8% | Inflation: 1.5% | MPC: 0.8 | Money Multiplier: 5</p>
                    </div>
                    
                    <div class="policy-tabs">
                        <button class="policy-tab active" onclick="switchPolicyTab('fiscal')">Fiscal Policy</button>
                        <button class="policy-tab" onclick="switchPolicyTab('monetary')">Monetary Policy</button>
                        <button class="policy-tab" onclick="switchPolicyTab('coordinated')">Coordinated Policy</button>
                    </div>
                    
                    <div class="calculator-container">
                        <div id="fiscalPolicy" class="policy-content active">
                            <h4>Fiscal Policy Tools:</h4>
                            <label>Government Spending Change (ΔG in billions):</label>
                            <input type="number" id="govSpending" class="calculator-input" min="-200" max="200" value="0">
                            
                            <label>Tax Change (ΔT in billions, positive for increase):</label>
                            <input type="number" id="taxChange" class="calculator-input" min="-200" max="200" value="0">
                            
                            <div class="policy-result">
                                <strong>Fiscal Impact:</strong> Primarily shifts IS curve. Spending has larger multiplier than taxes.
                            </div>
                        </div>
                        
                        <div id="monetaryPolicy" class="policy-content">
                            <h4>Monetary Policy Tools:</h4>
                            <label>Change Money Supply (ΔM in billions):</label>
                            <input type="number" id="moneySupply" class="calculator-input" min="-300" max="300" value="0">
                            
                            <label>Change Policy Interest Rate (percentage points):</label>
                            <input type="number" id="policyRate" class="calculator-input" min="-4" max="4" step="0.25" value="0">
                            
                            <div class="policy-result">
                                <strong>Monetary Impact:</strong> Primarily shifts LM curve. Money supply changes have direct effect.
                            </div>
                        </div>
                        
                        <div id="coordinatedPolicy" class="policy-content">
                            <h4>Coordinated Policy Approach:</h4>
                            <label>Fiscal Stimulus (combined G and T in billions):</label>
                            <input type="number" id="fiscalStimulus" class="calculator-input" min="-200" max="200" value="0">
                            
                            <label>Monetary Accommodation (money supply change in billions):</label>
                            <input type="number" id="monetaryAccommodation" class="calculator-input" min="-300" max="300" value="0">
                            
                            <div class="policy-result">
                                <strong>Coordinated Impact:</strong> IS and LM shift together. Can achieve equilibrium with less crowding out.
                            </div>
                        </div>
                        
                        <div class="attempt-counter">
                            Policy Attempts Used: <span id="attemptsUsed">0</span>/5
                        </div>
                        
                        <button onclick="calculateISLMEquilibrium()" style="width: auto;">Analyze Policy Impact</button>
                    </div>
                    
                    <div id="policyResult" class="feedback"></div>
                </div>
                
                <div class="interactive-simulation">
                    <h3>Policy Effect Identification</h3>
                    <p>Identify which curve would be primarily affected by each policy:</p>
                    <div id="currentPolicyScenario" class="formula-box">
                        <strong>Current Scenario:</strong> Government increases infrastructure spending
                    </div>
                    <div class="simulation-controls">
                        <button class="policy-choice" onclick="checkPolicyEffect('is', this)">Shifts IS Curve</button>
                        <button class="policy-choice" onclick="checkPolicyEffect('lm', this)">Shifts LM Curve</button>
                        <button class="policy-choice" onclick="checkPolicyEffect('both', this)">Shifts Both Curves</button>
                        <button class="policy-choice" onclick="checkPolicyEffect('movement', this)">Movement Along Curves</button>
                    </div>
                    <div id="policyEffectResult" class="feedback"></div>
                </div>
                
                <div id="simulationQuestions">
                    <!-- Questions will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="panel case-studies">
                <h2>Case Studies</h2>
                <p>Examine real-world applications of IS-LM analysis.</p>
                
                <div class="question">
                    <p><strong>Case 1:</strong> During the 2009 financial crisis, the US implemented both fiscal stimulus (ARRA) and monetary expansion (QE). The Fed kept rates near zero while government increased spending.</p>
                    <p>How did this policy mix affect the IS-LM equilibrium?</p>
                    <div class="options" id="case1Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback4" class="feedback"></div>
                </div>
                
                <div class="question">
                    <p><strong>Case 2:</strong> In the early 1980s, the Volcker Fed raised interest rates dramatically to combat inflation while Reagan implemented tax cuts. This created conflicting policy effects.</p>
                    <p>What was the net effect on the IS-LM equilibrium?</p>
                    <div class="options" id="case2Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback5" class="feedback"></div>
                </div>
                
                <div class="question">
                    <p><strong>Case 3:</strong> Japan's experience in the 1990s showed that when interest rates hit zero, monetary policy becomes ineffective (liquidity trap), requiring heavy reliance on fiscal policy.</p>
                    <p>How does this situation affect the IS-LM framework?</p>
                    <div class="options" id="case3Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback6" class="feedback"></div>
                </div>
            </div>
            
            <div class="panel managerial-implications">
                <h2>Managerial Implications</h2>
                <p>Understand how IS-LM equilibrium analysis impacts business decisions and strategy.</p>
                
                <div class="question">
                    <p>1. How can businesses use IS-LM analysis for investment timing decisions?</p>
                    <div class="options" id="managerial1Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback7" class="feedback"></div>
                </div>
                
                <div class="question">
                    <p>2. Why should companies monitor policy coordination between fiscal and monetary authorities?</p>
                    <div class="options" id="managerial2Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback8" class="feedback"></div>
                </div>
                
                <div class="question">
                    <p>3. How does crowding out affect business investment decisions?</p>
                    <div class="options" id="managerial3Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback9" class="feedback"></div>
                </div>
                
                <div class="question">
                    <p>4. What strategic advantage comes from anticipating IS-LM equilibrium changes?</p>
                    <div class="options" id="managerial4Options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    <div id="feedback10" class="feedback"></div>
                </div>
                
                <div class="economic-indicator">
                    <h3>Key Strategic Insights</h3>
                    <ul>
                        <li>Fiscal policy shifts IS curve, monetary policy shifts LM curve</li>
                        <li>Policy coordination can achieve goals with smaller changes</li>
                        <li>Crowding out occurs when fiscal expansion raises interest rates</li>
                        <li>Liquidity traps limit monetary policy effectiveness</li>
                        <li>Expectations influence both consumption and investment decisions</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Password protection
        const correctPassword = "ISLM2023";
        let score = 0;
        let policyAttempts = 0;
        const maxPossibleScore = 95;
        let currentEquilibrium = { output: 700, interest: 3 }; // Below potential
        let targetEquilibrium = { output: 1000, interest: 4 }; // Full employment equilibrium
        let answeredQuestions = new Set();
        
        // Questions with randomized answer positions
        const questions = [
            {
                id: 1,
                text: "The IS-LM model shows simultaneous equilibrium in:",
                options: [
                    "Goods and labor markets",
                    "Money and foreign exchange markets",
                    "Goods and money markets",
                    "All major macroeconomic markets"
                ],
                correct: 2,
                feedback: {
                    correct: "Correct! The IS-LM model shows where goods market (IS) and money market (LM) are simultaneously in equilibrium.",
                    incorrect: "Incorrect. The IS-LM model specifically shows goods and money market equilibrium."
                }
            },
            {
                id: 2,
                text: "What happens when fiscal policy increases government spending?",
                options: [
                    "LM curve shifts right",
                    "IS curve shifts right",
                    "Both curves shift right",
                    "Movement along existing curves"
                ],
                correct: 1,
                feedback: {
                    correct: "Right! Increased government spending raises aggregate demand, shifting the IS curve rightward.",
                    incorrect: "Fiscal policy primarily affects the IS curve, not the LM curve."
                }
            },
            {
                id: 3,
                text: "In a liquidity trap situation, monetary policy becomes ineffective because:",
                options: [
                    "The LM curve is vertical",
                    "The IS curve is horizontal",
                    "The LM curve is horizontal",
                    "The IS curve is vertical"
                ],
                correct: 2,
                feedback: {
                    correct: "Yes! In liquidity traps, money demand is perfectly elastic, making the LM curve horizontal and monetary policy ineffective.",
                    incorrect: "Liquidity traps create horizontal LM curves, not vertical ones."
                }
            },
            {
                id: 4,
                text: "In Case 1, the 2009 policy mix resulted in:",
                options: [
                    "Rightward shift of both IS and LM curves",
                    "Leftward shift of both curves",
                    "IS shifted right, LM shifted left",
                    "Only IS curve shifted significantly"
                ],
                correct: 0,
                feedback: {
                    correct: "Exactly! Fiscal stimulus shifted IS right, while monetary expansion shifted LM right, moving equilibrium toward full employment.",
                    incorrect: "Both expansionary fiscal and monetary policies shifted their respective curves rightward."
                }
            },
            {
                id: 5,
                text: "In Case 2, the Volcker-Reagan policies created:",
                options: [
                    "Definite expansionary effect",
                    "Definite contractionary effect",
                    "Conflicting effects on equilibrium",
                    "No net effect on the economy"
                ],
                correct: 2,
                feedback: {
                    correct: "Right! Tax cuts shifted IS right (expansionary) while high rates shifted LM left (contractionary), creating conflicting pressures.",
                    incorrect: "The policies had opposing effects - fiscal expansion vs monetary contraction."
                }
            },
            {
                id: 6,
                text: "In Case 3, Japan's liquidity trap meant:",
                options: [
                    "Fiscal policy was completely ineffective",
                    "Monetary policy could still stimulate effectively",
                    "Fiscal policy became more important",
                    "Both policies were equally effective"
                ],
                correct: 2,
                feedback: {
                    correct: "Correct! With monetary policy constrained by zero lower bound, fiscal policy became the primary tool for stimulus.",
                    incorrect: "Liquidity traps increase the importance of fiscal policy when monetary policy is ineffective."
                }
            },
            {
                id: 7,
                text: "How can businesses use IS-LM for investment timing?",
                options: [
                    "Predict interest rate and output combinations",
                    "Anticipate policy-induced economic shifts",
                    "Time capital investments strategically",
                    "All of the above"
                ],
                correct: 3,
                feedback: {
                    correct: "Yes! All these applications help businesses make better investment timing decisions.",
                    incorrect: "IS-LM analysis helps with interest rate/output predictions, policy anticipation, and investment timing."
                }
            },
            {
                id: 8,
                text: "Why monitor policy coordination?",
                options: [
                    "Coordinated policies have stronger effects",
                    "Policy conflicts can create uncertainty",
                    "Helps anticipate economic stability",
                    "All of the above"
                ],
                correct: 3,
                feedback: {
                    correct: "Right! Policy coordination affects economic stability, policy effectiveness, and business certainty.",
                    incorrect: "All these factors make policy coordination important for businesses to monitor."
                }
            },
            {
                id: 9,
                text: "How does crowding out affect businesses?",
                options: [
                    "Reduces private investment opportunities",
                    "Increases borrowing costs",
                    "Both A and B",
                    "Has no significant effect"
                ],
                correct: 2,
                feedback: {
                    correct: "Correct! Crowding out both reduces investment opportunities and increases borrowing costs for businesses.",
                    incorrect: "Crowding out affects businesses through both reduced opportunities and higher costs."
                }
            },
            {
                id: 10,
                text: "What advantage from anticipating equilibrium changes?",
                options: [
                    "First-mover advantage in strategy",
                    "Better resource allocation",
                    "Improved risk management",
                    "All of the above"
                ],
                correct: 3,
                feedback: {
                    correct: "Yes! All these strategic advantages come from anticipating IS-LM equilibrium changes.",
                    incorrect: "Anticipating equilibrium changes helps with strategy, allocation, and risk management."
                }
            }
        ];

        // Policy scenarios for practice
        const policyScenarios = [
            { scenario: "Government increases infrastructure spending", effect: "is" },
            { scenario: "Central bank conducts open market operations to increase money supply", effect: "lm" },
            { scenario: "Both fiscal stimulus and monetary expansion implemented together", effect: "both" },
            { scenario: "Economic growth increases income levels", effect: "movement" },
            { scenario: "Central bank raises reserve requirements", effect: "lm" },
            { scenario: "Government implements tax cuts for businesses", effect: "is" }
        ];
        
        let currentScenarioIndex = 0;
        let currentPolicyTab = 'fiscal';
        
        function checkPassword() {
            const input = document.getElementById('passwordInput').value;
            if (input === correctPassword) {
                document.getElementById('passwordScreen').style.display = 'none';
                document.getElementById('gameContent').style.display = 'block';
                initializeGame();
                drawISLMGraph();
                updateDisplay();
            } else {
                document.getElementById('passwordError').style.display = 'block';
            }
        }
        
        function switchPolicyTab(tabName) {
            // Update tabs
            document.querySelectorAll('.policy-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`.policy-tab[onclick="switchPolicyTab('${tabName}')"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.policy-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Policy').classList.add('active');
            
            currentPolicyTab = tabName;
        }
        
        function initializeGame() {
            // Shuffle questions and create HTML
            const shuffledQuestions = [...questions].sort(() => Math.random() - 0.5);
            
            // Populate simulation questions (first 3)
            const simulationContainer = document.getElementById('simulationQuestions');
            shuffledQuestions.slice(0, 3).forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.innerHTML = `
                    <p>${q.text}</p>
                    <div class="options" id="options${q.id}"></div>
                    <div id="feedback${q.id}" class="feedback"></div>
                `;
                simulationContainer.appendChild(questionDiv);
                
                // Shuffle and populate options
                const optionsContainer = document.getElementById(`options${q.id}`);
                const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
                const correctIndex = shuffledOptions.indexOf(q.options[q.correct]);
                
                shuffledOptions.forEach((option, optIndex) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.onclick = function() { 
                        if (!answeredQuestions.has(q.id)) {
                            answerQuestion(q.id, optIndex === correctIndex, this, q.feedback);
                            answeredQuestions.add(q.id);
                        }
                    };
                    optionsContainer.appendChild(button);
                });
            });
            
            // Populate case study questions (next 3)
            const caseQuestions = shuffledQuestions.slice(3, 6);
            caseQuestions.forEach((q, index) => {
                const caseNum = index + 4;
                const optionsContainer = document.getElementById(`case${caseNum-3}Options`);
                const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
                const correctIndex = shuffledOptions.indexOf(q.options[q.correct]);
                
                shuffledOptions.forEach((option, optIndex) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.onclick = function() { 
                        if (!answeredQuestions.has(q.id)) {
                            answerQuestion(q.id, optIndex === correctIndex, this, q.feedback);
                            answeredQuestions.add(q.id);
                        }
                    };
                    optionsContainer.appendChild(button);
                });
            });
            
            // Populate managerial questions (last 4)
            const managerialQuestions = shuffledQuestions.slice(6);
            managerialQuestions.forEach((q, index) => {
                const managerialNum = index + 7;
                const optionsContainer = document.getElementById(`managerial${managerialNum-6}Options`);
                const shuffledOptions = [...q.options].sort(() => Math.random() - 0.5);
                const correctIndex = shuffledOptions.indexOf(q.options[q.correct]);
                
                shuffledOptions.forEach((option, optIndex) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.onclick = function() { 
                        if (!answeredQuestions.has(q.id)) {
                            answerQuestion(q.id, optIndex === correctIndex, this, q.feedback);
                            answeredQuestions.add(q.id);
                        }
                    };
                    optionsContainer.appendChild(button);
                });
            });
        }
        
        function drawISLMGraph() {
            const graph = document.getElementById('islmGraph');
            const width = graph.offsetWidth;
            const height = graph.offsetHeight;
            
            // Clear previous graph
            graph.innerHTML = '';
            
            // Draw axes
            const xAxis = document.createElement('div');
            xAxis.className = 'graph-axis';
            xAxis.style.width = width - 40 + 'px';
            xAxis.style.height = '2px';
            xAxis.style.bottom = '40px';
            xAxis.style.left = '40px';
            graph.appendChild(xAxis);
            
            const yAxis = document.createElement('div');
            yAxis.className = 'graph-axis';
            yAxis.style.width = '2px';
            yAxis.style.height = height - 40 + 'px';
            yAxis.style.left = '40px';
            yAxis.style.bottom = '40px';
            graph.appendChild(yAxis);
            
            // Draw IS curve (downward sloping)
            for (let i = 0; i < width - 60; i += 3) {
                const point = document.createElement('div');
                point.className = 'graph-line';
                point.style.width = '2px';
                point.style.height = '2px';
                point.style.left = (40 + i) + 'px';
                point.style.bottom = (40 + (width - 60 - i) * 0.25) + 'px';
                point.style.backgroundColor = '#e74c3c';
                graph.appendChild(point);
            }
            
            // Draw LM curve (upward sloping)
            for (let i = 0; i < width - 60; i += 3) {
                const point = document.createElement('div');
                point.className = 'graph-line';
                point.style.width = '2px';
                point.style.height = '2px';
                point.style.left = (40 + i) + 'px';
                point.style.bottom = (40 + i * 0.2) + 'px';
                point.style.backgroundColor = '#3498db';
                graph.appendChild(point);
            }
            
            // Add equilibrium point
            const eqPoint = document.createElement('div');
            eqPoint.className = 'equilibrium-point';
            eqPoint.style.left = (width * 0.4) + 'px';
            eqPoint.style.bottom = (height * 0.5) + 'px';
            graph.appendChild(eqPoint);
            
            // Add labels
            const rLabel = document.createElement('div');
            rLabel.className = 'graph-label';
            rLabel.textContent = 'Interest Rate (r)';
            rLabel.style.left = '20px';
            rLabel.style.top = '10px';
            graph.appendChild(rLabel);
            
            const yLabel = document.createElement('div');
            yLabel.className = 'graph-label';
            yLabel.textContent = 'Output (Y)';
            yLabel.style.right = '10px';
            yLabel.style.bottom = '20px';
            graph.appendChild(yLabel);
            
            const isLabel = document.createElement('div');
            isLabel.className = 'graph-label';
            isLabel.textContent = 'IS';
            isLabel.style.right = '30px';
            isLabel.style.top = '30px';
            isLabel.style.color = '#e74c3c';
            graph.appendChild(isLabel);
            
            const lmLabel = document.createElement('div');
            lmLabel.className = 'graph-label';
            lmLabel.textContent = 'LM';
            lmLabel.style.left = '100px';
            lmLabel.style.bottom = '30px';
            lmLabel.style.color = '#3498db';
            graph.appendChild(lmLabel);
        }
        
        function calculateISLMEquilibrium() {
            if (policyAttempts >= 5) {
                document.getElementById('policyResult').innerHTML = 
                    "<strong>No more attempts!</strong> You've used all 5 policy attempts. Your final score has been calculated.";
                document.getElementById('policyResult').className = 'feedback incorrect';
                return;
            }
            
            policyAttempts++;
            document.getElementById('attemptsUsed').textContent = policyAttempts;
            document.getElementById('policyAttempts').textContent = policyAttempts;
            
            // Get policy inputs based on current tab
            let fiscalImpact = 0;
            let monetaryImpact = 0;
            
            if (currentPolicyTab === 'fiscal') {
                const govSpending = parseFloat(document.getElementById('govSpending').value) || 0;
                const taxChange = parseFloat(document.getElementById('taxChange').value) || 0;
                
                // Fiscal policy impacts (shifts IS curve)
                const mpc = 0.8;
                const spendingMultiplier = 1 / (1 - mpc); // 5
                const taxMultiplier = -mpc / (1 - mpc); // -4
                
                fiscalImpact = (govSpending * spendingMultiplier) + (taxChange * taxMultiplier);
                monetaryImpact = 0;
                
            } else if (currentPolicyTab === 'monetary') {
                const moneySupply = parseFloat(document.getElementById('moneySupply').value) || 0;
                const policyRate = parseFloat(document.getElementById('policyRate').value) || 0;
                
                // Monetary policy impacts (shifts LM curve)
                const moneyMultiplier = 5;
                fiscalImpact = 0;
                monetaryImpact = (moneySupply * moneyMultiplier) + (policyRate * -50); // Simplified impact
                
            } else if (currentPolicyTab === 'coordinated') {
                const fiscalStimulus = parseFloat(document.getElementById('fiscalStimulus').value) || 0;
                const monetaryAccommodation = parseFloat(document.getElementById('monetaryAccommodation').value) || 0;
                
                // Coordinated policy impacts
                const mpc = 0.8;
                const spendingMultiplier = 1 / (1 - mpc);
                const moneyMultiplier = 5;
                
                fiscalImpact = fiscalStimulus * spendingMultiplier;
                monetaryImpact = monetaryAccommodation * moneyMultiplier;
            }
            
            // Calculate new equilibrium
            const outputChange = fiscalImpact * 0.7 + monetaryImpact * 0.3; // Fiscal has larger output effect
            const interestChange = fiscalImpact * 0.1 + monetaryImpact * -0.2; // Monetary has larger interest effect
            
            const newOutput = currentEquilibrium.output + outputChange;
            const newInterest = Math.max(0, currentEquilibrium.interest + interestChange);
            
            // Calculate distance from target equilibrium
            const outputDistance = Math.abs(newOutput - targetEquilibrium.output);
            const interestDistance = Math.abs(newInterest - targetEquilibrium.interest);
            const totalDistance = outputDistance + interestDistance;
            
            // Calculate effectiveness (closer to target = higher score)
            const maxDistance = 500; // Maximum possible distance
            const effectiveness = Math.max(0, 100 - (totalDistance / maxDistance * 100));
            
            // Strategy bonus for using appropriate policy mix
            let strategyBonus = 0;
            if (currentEquilibrium.output < targetEquilibrium.output && outputChange > 0) {
                strategyBonus += 10; // Expansionary policy during recession
            }
            if (currentPolicyTab === 'coordinated') {
                strategyBonus += 5; // Bonus for coordinated approach
            }
            
            const pointsEarned = Math.floor(effectiveness / 3) + strategyBonus;
            score += pointsEarned;
            
            // Update current equilibrium
            currentEquilibrium = { output: newOutput, interest: newInterest };
            
            updateDisplay();
            
            // Determine equilibrium status
            let equilibriumStatus = "Not Achieved";
            if (totalDistance < 50) {
                equilibriumStatus = "Full Equilibrium Achieved!";
                score += 20; // Bonus for achieving equilibrium
            } else if (totalDistance < 150) {
                equilibriumStatus = "Near Equilibrium";
            }
            
            document.getElementById('equilibriumStatus').textContent = equilibriumStatus;
            document.getElementById('outputGap').textContent = `$${Math.round(targetEquilibrium.output - newOutput)}B ${newOutput < targetEquilibrium.output ? 'Recessionary' : 'Inflationary'} Gap`;
            document.getElementById('interestRate').textContent = `Interest Rate: ${newInterest.toFixed(2)}%`;
            
            document.getElementById('policyResult').innerHTML = `
                <strong>Policy Impact Analysis:</strong><br>
                Output Change: $${outputChange.toFixed(1)}B<br>
                Interest Rate Change: ${interestChange.toFixed(2)} percentage points<br>
                <strong>New Equilibrium:</strong> Y = $${newOutput.toFixed(0)}B, r = ${newInterest.toFixed(2)}%<br>
                Distance from Target: ${totalDistance.toFixed(1)} points<br>
                Effectiveness: ${effectiveness.toFixed(1)}%<br>
                Points Earned: ${pointsEarned}<br>
                <em>${equilibriumStatus.includes("Full Equilibrium") ? 'Excellent! You achieved simultaneous equilibrium!' : 
                     equilibriumStatus.includes("Near Equilibrium") ? 'Good progress! Getting closer to equilibrium.' : 
                     'Keep adjusting your policy mix to reach equilibrium.'}</em>
            `;
            
            if (equilibriumStatus.includes("Full Equilibrium")) {
                document.getElementById('policyResult').className = 'feedback correct';
            } else if (equilibriumStatus.includes("Near Equilibrium")) {
                document.getElementById('policyResult').className = 'feedback correct';
            } else {
                document.getElementById('policyResult').className = 'feedback incorrect';
            }
            
            updateDisplay();
        }
        
        function checkPolicyEffect(effect, button) {
            if (answeredQuestions.has('policy' + currentScenarioIndex)) {
                return; // Already answered this scenario
            }
            
            const resultElement = document.getElementById('policyEffectResult');
            const correctEffect = policyScenarios[currentScenarioIndex].effect;
            
            if (effect === correctEffect) {
                resultElement.innerHTML = `
                    <strong>Correct!</strong> ${getPolicyEffectExplanation(correctEffect)}
                `;
                resultElement.className = 'feedback correct';
                
                // Add to score for correct identification
                const points = Math.max(5, 15 - (answeredQuestions.size * 2));
                score += points;
                answeredQuestions.add('policy' + currentScenarioIndex);
            } else {
                resultElement.innerHTML = `
                    <strong>Incorrect.</strong> ${getPolicyEffectExplanation(correctEffect)}
                `;
                resultElement.className = 'feedback incorrect';
            }
            
            updateDisplay();
            
            // Move to next scenario after a delay
            setTimeout(nextPolicyScenario, 2500);
        }
        
        function getPolicyEffectExplanation(effect) {
            const explanations = {
                'is': 'This policy primarily affects aggregate demand and shifts the IS curve.',
                'lm': 'This policy primarily affects money supply/demand and shifts the LM curve.',
                'both': 'This coordinated approach affects both goods and money markets, shifting both curves.',
                'movement': 'This represents a change in economic conditions that causes movement along existing curves.'
            };
            return explanations[effect];
        }
        
        function nextPolicyScenario() {
            currentScenarioIndex = (currentScenarioIndex + 1) % policyScenarios.length;
            const scenarioElement = document.getElementById('currentPolicyScenario');
            scenarioElement.innerHTML = `
                <strong>Current Scenario:</strong> ${policyScenarios[currentScenarioIndex].scenario}
            `;
            
            // Clear the previous result
            document.getElementById('policyEffectResult').innerHTML = '';
            document.getElementById('policyEffectResult').className = 'feedback';
        }
        
        function updateDisplay() {
            // Update score display (capped at maxPossibleScore)
            const displayScore = Math.min(score, maxPossibleScore);
            document.getElementById('score').textContent = displayScore;
            
            // Check if game should end
            if (policyAttempts >= 5) {
                endGame();
            }
        }
        
        function endGame() {
            const finalScore = Math.min(maxPossibleScore, score);
            document.getElementById('score').textContent = finalScore;
            
            // Disable all interactive elements
            const allButtons = document.querySelectorAll('button');
            allButtons.forEach(btn => {
                if (!btn.onclick || !btn.onclick.toString().includes('checkPassword')) {
                    btn.disabled = true;
                }
            });
            
            const allInputs = document.querySelectorAll('input');
            allInputs.forEach(input => input.disabled = true);
            
            document.getElementById('policyResult').innerHTML += 
                `<br><br><strong>Game Over! Final Score: ${finalScore}%</strong><br>
                 <em>${finalScore >= 80 ? 'Excellent understanding of IS-LM equilibrium!' : 
                      finalScore >= 60 ? 'Good grasp of policy effects!' : 
                      'Review the concepts and try again!'}</em>`;
        }
        
        function answerQuestion(questionId, isCorrect, button, feedback) {
            if (answeredQuestions.has(questionId)) {
                return; // Already answered this question
            }
            
            const feedbackElement = document.getElementById(`feedback${questionId}`);
            
            if (isCorrect) {
                // Correct answer
                feedbackElement.innerHTML = feedback.correct;
                feedbackElement.className = 'feedback correct';
                
                // Points with diminishing returns
                const basePoints = 10;
                const points = basePoints - (answeredQuestions.size * 1.5);
                
                score += Math.max(5, points);
                answeredQuestions.add(questionId);
            } else {
                // Incorrect answer
                feedbackElement.innerHTML = feedback.incorrect;
                feedbackElement.className = 'feedback incorrect';
                
                // Small penalty for incorrect answers
                score = Math.max(0, score - 2);
                answeredQuestions.add(questionId); // Count attempt even if wrong
            }
            
            updateDisplay();
            
            // Disable all buttons for this question
            const buttons = button.parentElement.getElementsByTagName('button');
            for (let btn of buttons) {
                btn.disabled = true;
            }
        }
        
        // Initialize the first scenario
        window.onload = function() {
            if (document.getElementById('currentPolicyScenario')) {
                document.getElementById('currentPolicyScenario').innerHTML = `
                    <strong>Current Scenario:</strong> ${policyScenarios[0].scenario}
                `;
            }
        };
    </script>
</body>
</html>
